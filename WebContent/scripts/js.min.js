function addLoadEvent(func){var oldOnLoad=window.onload;if(typeof window.onload!='function'){window.onload=func}else{window.onload=function(){func();oldOnLoad()}}};function getContextPath(){var curWwwPath=window.document.location.href;var pathName=window.document.location.pathname;var pos=curWwwPath.indexOf(pathName);var localhostPaht=curWwwPath.substring(0,pos);var projectName=pathName.substring(0,pathName.substr(1).indexOf('/')+1);return(localhostPaht+projectName)};var contextPath;function ScollPostion(){var t,l,w,h;if(document.documentElement&&document.documentElement.scrollTop){t=document.documentElement.scrollTop}else if(document.body){t=document.body.scrollTop}return t};jQuery(showAsScreenScroll($));function showAsScreenScroll(){var topNav=$("#top-nav");var background=$("#background");var userNav=$("#user-nav");var topNavBackground=$("#topnav-background");var topNavPart=$("#top-nav-part");var editArticle=$("#edit-article");var categoryNavBar=$("div#category-nav-bar");if(editArticle.length!=0){topNav.removeClass("navbar-fixed-top")};if(topNavPart.length!=0){topNavPart.css("height",topNav.height())}if(topNavBackground.length==0){topNav.mouseenter(function(){topNav.css("background-color","whitesmoke")});topNav.mouseleave(function(){if(ScollPostion()==0){topNav.css("background-color","transparent")}})}else{topNav.mouseenter(function(){topNav.css("background-color","whitesmoke")});topNav.mouseleave(function(){if(ScollPostion()==0){topNav.css("background-color","#ffffff4d")}})};var handUp=$("#hand-up");handUp.click(function(e){$("html,body").animate({scrollTop:0,},500)});if(categoryNavBar.length!=0){var categoryNavBarOffset=categoryNavBar.offset().top}document.onscroll=function(){var top=ScollPostion();var topNavBackgroundColor=(top>topNav.height()+10)?"whitesmoke":"transparent";topNav.css("background-color",topNavBackgroundColor);var handUpDisplay=(top==0)?"none":"block";handUp.css("display",handUpDisplay);if(categoryNavBar.length!=0&&top==0){categoryNavBar.clearQueue().animate({top:categoryNavBarOffset,},function(){if(categoryNavBar.length!=0&&top>categoryNavBar.get(0).offsetTop){categoryNavBar.clearQueue().animate({top:topNav.height()+10,})}})};if(categoryNavBar.length!=0&&top>categoryNavBar.get(0).offsetTop){categoryNavBar.clearQueue().animate({top:topNav.height()+10,},function(){if(categoryNavBar.length!=0&&top==0){categoryNavBar.clearQueue().animate({top:categoryNavBarOffset,},"fast")}})}if(userNav.length!=0){var userNavFixedTop=(top>userNav.get(0).offsetTop)?true:false;var navbarFixedTop="navbar-fixed-top";if(userNavFixedTop){userNav.addClass(navbarFixedTop).slideDown(500);topNav.hide()}else{userNav.removeClass(navbarFixedTop);topNav.show()}}else{}}};jQuery(showCategory($));function showCategory(){var topNav=$("#top-nav");$("body").on("click",".suspend-menu .menu-item",function(){var categorySel=$(this).find("a").attr("href");$("html,body").animate({scrollTop:($(categorySel).offset().top-500),},1000)})}jQuery(mouseEnterUserHeadImg($));function mouseEnterUserHeadImg(){var userHeadimgOp=$(".user-headimg-op");var userOpPanel=$(".user-oppanel");userHeadimgOp.mouseenter(function(){userOpPanel.stop().fadeIn()});userHeadimgOp.mouseleave(function(){userOpPanel.stop().fadeOut()});userOpPanel.mouseenter(function(){userOpPanel.stop().fadeIn()})};jQuery(showAndHideArticleNav($));function showAndHideArticleNav(){var articleNavBtn=$(".article-nav-btn");var articleNav=$("#article-nav");articleNavBtn.mouseenter(function(){articleNav.stop().slideDown()});articleNavBtn.mouseleave(function(){articleNav.stop().slideUp()})};jQuery(listenerWallPaper($));function listenerWallPaper(){var wallPaper=$(".wall-paper");var backgroundImage=$("#wall-paper-img");if(backgroundImage.length==0)return;backgroundImage.click(function(e){var backImage=["2-1","3-1","4-1","7-1","9-1","11-1","13-1"];var random=Math.floor(Math.random()*(backImage.length));backgroundImage.attr("src","images/wallpaper/"+backImage[random]+".jpg")});var wallPaperInner=$(".wall-paper-inner");var wallpaperFormDiv=$(".wallpaper-form-div");wallPaperInner.on({"click mouseenter":function(e){wallPaperInner.stop().slideUp(500,function(){wallpaperFormDiv.stop().fadeIn()})},});wallpaperFormDiv.on({"mousemove keyup":function(){wallPaperInner.stop().slideUp(500,function(){wallpaperFormDiv.stop().fadeIn()})}});$("html").on({"mouseleave":function(){wallPaperInner.delay(5000).slideDown();wallpaperFormDiv.stop().delay(4300).fadeOut(500)},"mousemove keyup":function(){wallPaperInner.stop().slideUp(500,function(){wallpaperFormDiv.stop().fadeIn()})},})};function initBackGroundImageAsWindowResize(backgroundImage){if(!backgroundImage){return false};var width=$(window).width();var wallPaperInner=$(".wall-paper-inner");backgroundImage.width(width).height($(window).height());wallPaperInner.height($(window).height())};function changeBackGroundImageAsWindowResize(backgroundImage,oldSrc){if(!oldSrc){return false}var width=$(window).width();if(width<1024){var srcAry=oldSrc.split("-1");var newSrc=srcAry[0].concat(srcAry[1]);backgroundImage.attr("src",newSrc)}else{backgroundImage.attr("src",oldSrc)}};function initAndChangeBackGroundImageAsWindowResize(backgroundImage){initBackGroundImageAsWindowResize(backgroundImage);var oldSrc=backgroundImage.attr("src");changeBackGroundImageAsWindowResize(backgroundImage,oldSrc);$(window).resize(function(){initBackGroundImageAsWindowResize(backgroundImage);changeBackGroundImageAsWindowResize(backgroundImage,oldSrc)})};jQuery(initBackgroundImage($));function initBackgroundImage(){var backgroundImage=$("#wall-paper-img");initAndChangeBackGroundImageAsWindowResize(backgroundImage)};function showDateTime(dateTime){var yearMonthDay=dateTime.find(".year-month-day");var week=dateTime.find(".week");var time=dateTime.find(".time");var date=new Date();yearMonthDay.text(date.getFullYear()+"年"+date.getMonth()+1+"月"+date.getDate()+"日");week.text(getWeek(date));var minute=date.getMinutes().toString();minute=(minute.length==1)?"0"+minute:minute;time.text(date.getHours()+":"+minute)};function showTime(dateTime){var time=dateTime.find(".time");var date=new Date();var minute=date.getMinutes().toString();minute=(minute.length==1)?"0"+minute:minute;time.text(date.getHours()+":"+minute)};function getWeek(date){var day=date.getDay();switch(day){case 0:return"周日";break;case 1:return"周一";break;case 2:return"周二";break;case 3:return"周三";break;case 4:return"周四";break;case 5:return"周五";break;case 6:return"周六";break;default:break}};jQuery(backgroundDateTime($));function backgroundDateTime(){var dateTime=$(".date-time");showDateTime(dateTime);var date=new Date();setInterval(function(){showTime(dateTime)},(60-date.getSeconds())*1000)};window.onload=function(){(function($){funObj={timeUserFun:'timeUserFun',};$[funObj.timeUserFun]=function(time){var time=time||2;var userTime=time*60;var objTime={init:0,time:function(){objTime.init+=1;if(objTime.init==userTime){}},eventFun:function(){clearInterval(testUser);objTime.init=0;testUser=setInterval(objTime.time,1000)},};var testUser=setInterval(objTime.time,1000);var body=document.querySelector('html');body.addEventListener("click",objTime.eventFun);body.addEventListener("keydown",objTime.eventFun);body.addEventListener("mousemove",objTime.eventFun);body.addEventListener("mousewheel",objTime.eventFun)}})(window);timeUserFun(0.1)};jQuery(showHeadImgWhenInputUserName($));function showHeadImgWhenInputUserName(){var loginForm=$("#login-form");var userName=loginForm.find("input[name=name]");var headImg=loginForm.find("#user-headimg");var timeout,delay=1800;userName.keyup(function(e){clearTimeout(timeout);timeout=setTimeout(function(){var name=userName.val();if(!name)return false;var url=contextPath+"/fore/user/"+name+"/headImg";$.get(url,function(data,textStatus,jqXHR){if("no"!=data){headImg.attr("src",contextPath+"/"+data)}},"text")},delay)})};jQuery(loginForm($));function loginForm(){var loginForm=$("#login-form");initFormValidErrMsg(loginForm)};jQuery(registerForm($));function registerForm(){var registerForm=$("#register-form");initFormValidErrMsg(registerForm);var fieldsOption={name:{message:"用户名无效",validators:{notEmpty:{message:"用户名不能为空"},stringLength:{min:2,max:25,message:"标题长度必须在 2 - 25 之间"},},},password:{message:"密码无效",validators:{notEmpty:{message:"密码不能为空"},stringLength:{min:5,max:60,message:"密码长度必须在 5 - 60 之间"},identical:{field:'repassword',message:"确认密码必须与密码相同",},},},repassword:{message:"确认密码无效",validators:{notEmpty:{message:"确认密码不能为空"},identical:{field:'password',message:"确认密码必须与密码相同",},},},};boostrapValidate(registerForm,fieldsOption)};function initPageAttr(sel,num,min,max){if(!validSelValNotEmpty(sel)){sel.val(num)};if(validSelValInt(sel)){if(!validSelNumRange(sel,min,max)){sel.val(num)}}else{if(validSelNumRange(sel,min,max)){sel.val(parseInt(sel.val()))}else{sel.val(num)}}};function assignAspageAttrChange(){var pageInput=$(".change-page input");window.location.assign(handleUrl(pageInput.serialize()))};function handleUrl(param){var href=window.location.href;var index=href.indexOf("?");if(index==-1){return href+"?"+param}var params=href.split("?")[1];var orginHref=href.substr(0,index+1);var originParamAry=params.split("&");var styAry=["pageRecord","current"];var pramAry=originParamAry.filter(function(v){return!styAry.includes(v.split("=")[0])});var impParam=pramAry.toString().replace(",","&");var newHref=(impParam)?orginHref+impParam+"&"+param:orginHref+param;return newHref};jQuery(listenerChangeClick($));function listenerChangeClick(){var changePageRecord=$("#change-pagerecord-btn");var changeCurrent=$("#change-current-btn");changePageRecord.click(function(e){assignAspageAttrChange()});changeCurrent.click(function(e){assignAspageAttrChange()})};function changePageRecordCurrent(){var pageRecord=$("input[name=pageRecord]");var current=$("input[name=current]");var cVal=$(".current").text();var pRVal=$(".page-record").text();var tVal=$(".total").text();var tPVal=$(".total-page").text();pageRecord.val(pRVal);current.val(cVal);pageRecord.change(function(e){initPageAttr(pageRecord,pRVal,1,parseInt(tVal))});current.change(function(e){initPageAttr(current,cVal,1,parseInt(tPVal))})};function checkAryValueIsConsitent(ary,ary2){return ary.sort().toString()==ary2.sort().toString()};function validSelValNotEmpty(sel){var val=sel.val();if(val.length!=0){return true};return false};function validSelNumRange(sel,min,max){var val=sel.val();if(isNaN(min)||isNaN(max))return false;if(min<=val&&val<=max){return true}return false}function validSelValRange(sel,min,max){var val=sel.val();if(isNaN(min)||isNaN(max))return false;var vLen=val.length;if(min<=vLen&&vLen<=max){return true}return false}function validSelValConsitent(sel1,sel2){var val1=sel1.val();var val2=sel2.val();if(val1==val2){return true}return false}function validSelValNum(sel){var val=sel.val();if(!isNaN(val)){return true}return false}function validSelValInt(sel){var val=sel.val();if(parseInt(val)==val){return true}return false}jQuery(closeFormErrMsg($));function closeFormErrMsg(){var closeMsgBtn=$(".close-msg-btn");closeMsgBtn.click(function(e){var formOpSuccessMsg=$(this).parent(".form-op-successmsg");var formOpErrMsg=$(this).parent(".form-op-errmsg");var formValidErrMsg=$(this).parent(".form-valid-errmsg");formOpSuccessMsg.css("display","none");formOpErrMsg.css("visibility","hidden");formValidErrMsg.css("display","none")})}function initFormValidErrMsg(form){var validErrMsg=form.find(".form-valid-errmsg .errmsg");var btn=validErrMsg.next();var formValidErrMsg=validErrMsg.parent();btn.css("display","block");formValidErrMsg.css("display","flex")}function checkForm(form){var input=form.find("input")}function showTipModal(title,body,isSuccess){var success="text-success";var danger="text-danger";clazz=(isSuccess)?success:danger;var modal=$("#tip-modal");var modalTitle=modal.find(".modal-title").children();var modalBody=modal.find(".modal-body").children();modalTitle.removeClass().addClass(clazz).text(title);modalBody.removeClass().addClass(clazz).text(body);modal.modal({show:true,backdrop:'static',keyboard:false})}function hideTipModal(delay){delay=(!delay)?1500:delay;var modal=$("#tip-modal");setTimeout(function(){modal.modal("hide")},delay)}function showSuccessTipModal(title,body){showTipModal(title,body,true)}function showDangerTipModal(title,body){showTipModal(title,body,false)}function showAndHideTipToast(text,styClass){var tipDialog=$(".tip-dialog");var tipToast=$("<div class='tip-toast'>"+text+"</div>");tipDialog.append(tipToast);tipToast.addClass(styClass).delay(4200).fadeOut("slow",function(){$(this).remove()})}function showAndHideSuccessTipToast(text){var styClass="toast-success";showAndHideTipToast(text,styClass)}function showAndHideDangerTipToast(text){var styClass="toast-danger";showAndHideTipToast(text,styClass)}function showAndHideNormalTipToast(text){var styClass="toast-normal";showAndHideTipToast(text,styClass)}function getIdOnBtnTable(btn,table){var th=table.find("th");var id="";th.each(function(index,element){var ele=$(this);if(ele.attr("field")=="id"){var tr=btn.parents("tr");var td=tr.find("td");var jqTd=$(td[index]);id=jqTd.text();return false}});return id}function getFieldAttrTextReturnFieldMapFromBtnParentsSel(btn,parentSel){var field=btn.parents(parentSel).find("[field]");var fieldMap=new Map();field.each(function(index,element){var ele=$(this);var fieldName=ele.attr("field");var fieldValue=ele.text();fieldMap.set(fieldName,fieldValue)});return fieldMap}function getOnlyReadFieldAttrTextReturnOnlyReadFieldMapFromBtnParentsSel(btn,parentSel){var onlyReadField=new Map();var field=btn.parents(parentSel).find("[field]");field.each(function(index,element){var ele=$(this);var fieldName=ele.attr("field");var fieldValue=ele.text();if(field.attr("onlyread")=="true"){onlyReadField.set(fieldName,fieldValue);return false}});return onlyReadField}function getOneFieldAttrTextReturnFieldMapFromBtnParentsSel(btn,parentSel,fieldName){var field=btn.parents(parentSel).find("[field="+fieldName+"]");var fieldMap=new Map();var fieldValue=field.text();fieldMap.set(fieldName,fieldValue);return fieldMap}function getFieldAryFromTableTh(table){var th=table.find("th");var fieldAry=[];th.each(function(index,element){var ele=$(this);if(th.attr("field")){fieldAry.push(ele.attr("field"))}else{fieldAry.push("")}});return fieldAry}function getFieldAttrReturnFieldMapFromFieldAryOnBtnTable(btn,table){var fieldAry=getFieldAryFromTableTh(table);var tr=btn.parents("tr");var td=tr.find("td");var fieldMap=new Map();$.each(fieldAry,function(index,value){if(value){var jqTd=$(td[index]);fieldMap.set(value,jqTd.text())}});return fieldMap}function getFieldIndexFromTableTh(table){var th=table.find("th");var fieldIndex=new Map();th.each(function(index,element){var ele=$(this);var fieldName=ele.attr("field");if(fieldName){fieldIndex.set(index,fieldName)}});return fieldIndex}function getOnlyReadFieldIndexFromTableTh(table){var th=table.find("th");var fieldIndex=new Map();th.each(function(index,element){var ele=$(this);if(ele.attr("onlyread")=="true"){var fieldName=ele.attr("field");if(fieldName){fieldIndex.set(index,fieldName)}}});return fieldIndex}function getOneFieldIndexFromTableTh(table,fieldName){var th=table.find("th");var fieldIndex=new Map();th.each(function(index,element){var ele=$(this);var name=ele.attr("field");if(fieldName==name){fieldIndex.set(index,fieldName);return false}});return fieldIndex}function getFieldAttrReturnFieldMapFromFieldIndexOnBtnTable(btn,table){var fieldIndex=getFieldIndexFromTableTh(table);var tr=btn.parents("tr");var td=tr.find("td");var fieldMap=new Map();for(var[key,value]of fieldIndex){var jqTd=$(td[key]);fieldMap.set(value,jqTd.text())}return fieldMap}function getOnlyReadFieldAttrTextReturnOnlyReadFieldMapFromFieldIndexOnBtnTable(btn,table){var onlyReadFieldIndex=getOnlyReadFieldIndexFromTableTh(table);var tr=btn.parents("tr");var td=tr.find("td");var onlyReadFieldMap=new Map();for(var[key,value]of onlyReadFieldIndex){var jqTd=$(td[key]);fieldMap.set(value,jqTd.text())}return onlyReadFieldMap}function checkFormRepeatAsFieldMap(form,fieldMap){var i=0;var formEleLen=0;for(var[key,value]of fieldMap){var formEle=form.find("[name="+key+"]");if(formEle.length!=0){formEleLen+=1}var tag=formEle.prop("nodeName");var type=formEle.attr("type");if("INPUT"==tag){if("radio"==type){var checkedFormEle=form.find("[name="+key+"]:checked");if(checkedFormEle.nextAll("span").not("span[class]").text()==value){i+=1}}else if("checkbox"==type){formEle.each(function(index,element){var ele=$(this);if(ele.prop("checked")){if(ele.next().text()==value){i+=1}}})}else if(formEle.val()==value){i+=1}}else if("SELECT"==tag){var checkedOption=formEle.find("option:checked");if(checkedOption.text()==value){i+=1}}else if("TEXTAREA"==tag){if(formEle.val()==value){i+=1}}}if(i==formEleLen){return true}return false}function loadDataToFormAsFieldMap(form,fieldMap){for(var[key,value]of fieldMap){var formEle=form.find("[name="+key+"]");if(!formEle)continue;var tag=formEle.prop("nodeName");var type=formEle.attr("type");if("INPUT"==tag){if("radio"==type){formEle.each(function(index,element){var ele=$(this);if(ele.nextAll("span").not("span[class]").text()==value){ele.prop("checked",true);return true}})}else if("checkbox"==type){formEle.each(function(index,element){var ele=$(this);if(ele.next().text()==value){ele.prop("checked",true)}})}else{formEle.val(value)}}else if("SELECT"==tag){var option=formEle.find("option");option.each(function(index,element){var ele=$(this);if(ele.text()==value){formEle.val(ele.val())}})}else if("TEXTAREA"==tag){formEle.val(value)}else{formEle.text(value)}}}function getIdOnBtnTable(btn,table){var th=table.find("th");var id="";th.each(function(index,element){var ele=$(this);if(ele.attr("field")=="id"){var tr=btn.parents("tr");var td=tr.find("td");var jqTd=$(td[index]);id=jqTd.text();return false}});return id}function getIdOnEle(ele){return ele.find("[field=id]").text()}function getFieldTextIndexFromTableTh(table){var th=table.find("th");var fieldTextIndex=new Map();th.each(function(index,element){var ele=$(this);var fieldName=ele.attr("text");if(fieldName){fieldTextIndex.set(index,fieldName)}});return fieldTextIndex}function getFieldTextAttrReturnFieldTextMapFromFieldTextIndexOnBtnTable(btn,table){var fieldTextIndex=getFieldTextIndexFromTableTh(table);var tr=btn.parents("tr");var td=tr.find("td");var fieldTextMap=new Map();for(var[key,value]of fieldTextIndex){var jqTd=$(td[key]);fieldTextMap.set(value,jqTd.text())}return fieldTextMap}function loadDataToEleAsFieldTextMap(ele,fieldTextMap){for(var[key,value]of fieldTextMap){var eleSpan=ele.find("[text="+key+"]");if(!eleSpan)continue;eleSpan.text(value)}}function clearDataInEleAsFieldTextMap(ele,fieldTextMap){for(var[key,value]of fieldTextMap){var eleSpan=ele.find("[text="+key+"]");if(eleSpan.length==0)continue;eleSpan.text("")}}function loadFieldMapDataToFormInModalOnClickBtnSelAndParentSelInParentsSel(modal,form,parentsSel,btnSel,parentSel,fieldsOption,afterFunc){var editArticleContentBtn=modal.find("#edit-articlecontent-btn");$(parentsSel).on("click",btnSel,function(e){var fieldMap=new Map();var onlyReadFieldMap=new Map();var fillBtn=form.find(".fill-btn");var resetBtn=form.find("[type=reset]");var submitBtn=form.find(".submit-btn");var formOpErrmsg=form.find(".form-op-errmsg");var errMsg=formOpErrmsg.find(".errmsg");e.preventDefault();var btn=$(this);var parent=btn.parents(parentSel);fieldMap=getFieldAttrTextReturnFieldMapFromBtnParentsSel(btn,parentSel);onlyReadFieldMap=getOnlyReadFieldAttrTextReturnOnlyReadFieldMapFromBtnParentsSel(btn,parentSel);var href=contextPath+"/foreeditArticle?aid="+fieldMap.get("id");editArticleContentBtn.attr("href",href);loadDataToFormAsFieldMap(form,fieldMap);formOpErrmsg.css("visibility","hidden");modal.modal("show");fillBtn.click(function(e){form.data('bootstrapValidator').resetForm();loadDataToFormAsFieldMap(form,fieldMap)});resetBtn.click(function(e){e.preventDefault();form.get(0).reset();loadDataToFormAsFieldMap(form,onlyReadFieldMap);form.data('bootstrapValidator').resetForm()});boostrapValidate(form,fieldsOption);form.on('success.form.bv',function(e){e.preventDefault();if(checkFormRepeatAsFieldMap(form,fieldMap)){errMsg.text("你都完全没有改过");formOpErrmsg.css("visibility","visible")}else{afterFunc(form,parent)}}).on('error.field.bv',function(e,data){loadDataToFormAsFieldMap(form,onlyReadFieldMap)})});modal.on('hide.bs.modal',function(){form.get(0).reset();form.data('bootstrapValidator').resetForm();form.removeClass("in")})}function loadFieldMapDataFromTableToFormInModalOnClickBtnSelAndParentSel(modal,table,form,parentsSel,btnSel,fieldsOption,afterFunc){$(parentsSel).on("click",btnSel,function(e){var fieldMap=new Map();var onlyReadFieldMap=new Map();var fillBtn=form.find(".fill-btn");var resetBtn=form.find("[type=reset]");var submitBtn=form.find("[type=submit]");var formOpErrmsg=form.find(".form-op-errmsg");var errMsg=formOpErrmsg.find(".errmsg");var btn=$(this);fieldMap=getFieldAttrReturnFieldMapFromFieldIndexOnBtnTable(btn,table);onlyReadFieldMap=getOnlyReadFieldAttrTextReturnOnlyReadFieldMapFromFieldIndexOnBtnTable(btn,table);fieldTextMap=getFieldTextAttrReturnFieldTextMapFromFieldTextIndexOnBtnTable(btn,table);loadDataToEleAsFieldTextMap(form,fieldTextMap);loadDataToFormAsFieldMap(form,fieldMap);formOpErrmsg.css("visibility","hidden");modal.modal("show");fillBtn.click(function(e){form.data('bootstrapValidator').resetForm();loadDataToFormAsFieldMap(form,fieldMap)});resetBtn.click(function(e){e.preventDefault();form.get(0).reset();form.data('bootstrapValidator').resetForm();loadDataToFormAsFieldMap(form,onlyReadFieldMap)});boostrapValidate(form,fieldsOption);form.on('success.form.bv',function(e){e.preventDefault();if(checkFormRepeatAsFieldMap(form,fieldMap)){errMsg.text("你都完全没有改过");formOpErrmsg.css("visibility","visible")}else{afterFunc(form,btn,table)}}).on('error.field.bv',function(e,data){loadDataToFormAsFieldMap(form,onlyReadFieldMap)});modal.on('hide.bs.modal',function(){form.get(0).reset();form.data('bootstrapValidator').resetForm()})})};function deleteInModalOnClickBtnSelAndParentSel(modal,table,parentsSel,delBtnSel,url){$(parentsSel).on("click",delBtnSel,function(e){var btn=$(this);var id=getIdOnBtnTable(btn,table);modal.modal("show");var confirmBtn=modal.find(".confirm-btn");confirmBtn.click(function(e){var data={id:id,};$.ajax({type:"GET",url:url,data:data,dataType:"application/json",success:function(response){if("success"==response){$(delBtnSel).parents("tr").remove()}}})})})};function deleteInModalOnClickBtnSelAndParentSelInEle(modal,ele,parentsSel,delBtnSel,url){var id="";$(parentsSel).on("click",delBtnSel,function(e){var btn=$(this);id=getIdOnBtnEle(btn,ele);id=getIdOnEle(ele),modal.modal("show")});var confirmBtn=modal.find(".confirm-btn");confirmBtn.click(function(e){var data={id:id,};$.post(url,data,function(data,textStatus,jqXHR){if("success"==response){ele.remove()}},"text")})}function setHrefToForm(originHref,fieldMap){}function fadeTipAfterOp(text){var tip=$(".alreadyOp");tip.text(text).fadeIn(400).delay(3500).fadeOut(400)}function getFileName(originFileName){return originFileName.slice(originFileName.lastIndexOf("\\")+1)}function getFileNameExten(originFileName){return originFileName.slice(originFileName.lastIndexOf(".")+1)}function isSupportFileExten(exten){var support=["jpg","png"];for(var i=0,len=support.length;i<len;i++){if(exten.toLowerCase()==support[i]){return true}}return false}function isSupportFileSize(size){if(0<size&&size<=3145728){return true}return false}function isSupportWH(width,height){var i=0;if(0<width&&width<5000){i+=1}if(0<height&&height<=5000){i+=1}if(i==2){return true}return false}jQuery(selUpLoadImg($));function selUpLoadImg(){var selImg=$(".selUpLoadImg");selImg.click(function(e){var ele=$(this);var realImg=ele.next();realImg.click()})}jQuery(viewImgInfo($));function viewImgInfo(){var viewImgInfoBtn=$(".viewImgInfoBtn");viewImgInfoBtn.click(function(e){var btn=$(this);var upLoadImgInfo=btn.parents(".upLoadImg").find(".upLoadImgInfo");upLoadImgInfo.stop().slideToggle();if(btn.text()=="关闭"){btn.stop().text("查看").attr("title","查看上传图片信息")}else{btn.stop().text("关闭").attr("title","关闭上传图片信息")}})}function getFileInputInfo(file){return[file.name,getFileNameExten(file.name),file.size]}function preViewImgInModa(){var preViewImgBtn=$(".preViewImgBtn");var preViewImgModal=$("#previewimg-modal");preViewImgBtn.click(function(e){var url=contextPath+"/foregetUserInfoImg";var img=preViewImgModal.find("img");$.get(url,function(data,textStatus,jqXHR){img.each(function(index,element){$(this).attr("src",data[index])});preViewImgModal.modal("show")},"text")})}jQuery(resetImgAndInfo($));function resetImgAndInfo(){var resetImgBtn=$(".resetImgBtn");resetImgBtn.click(function(e){var btn=$(this);var imgInfoTable=btn.parent().prev().children();var upLoadImgInfo=btn.parents(".upLoadImg").find(".upLoadImgInfo");var upLoadImgContainer=upLoadImgInfo.parents(".upLoadImg-container");var upLoadImg=btn.parents(".upLoadImg").find(".showImg");var fileInput=upLoadImgContainer.find("input");fileInput.val("");upLoadImg.attr('src',"").removeClass("img-thumbnail");upLoadImgContainer.css("height","20rem");imgInfoTable.find("td").text("")})}function addUpLaoadImg(){var add=$(".addUpLaoadImg");add.click(function(e){if($(".showImg").length<6){var upLoadImg=$(".upLoadImg:first");add.before(upLoadImg.clone(true));add.attr("display","block");var resetImgBtn=add.prev().find(".resetImgBtn");resetImgBtn.click()}else{e.preventDefault();add.attr("display","none")}})}function deleteUpLaoadImg(){var delImgBtn=$(".delImgBtn");delImgBtn.click(function(e){var upLoadImg=$(this).parents(".upLoadImg");var upLoadImgDiv=upLoadImg.parent(".upLoadImgDiv-container");var showImg=upLoadImgDiv.find(".showImg");if(showImg.length>1){upLoadImg.remove()}else{e.preventDefault()}})}jQuery(saveUpLaoadImg($));function saveUpLaoadImg(){var saveImgBtn=$(".saveImgBtn");saveImgBtn.click(function(e){var btn=$(this);var upLoadImgDiv=btn.parents(".upLoadImgDiv");var imgInput=btn.parent().prev().find(".realImg");if(!imgInput.val()){showDangerTipModal("上传用户自定义图片","失败：上传图片不为空");return}if(!checkIsLogin())return;var imgType=btn.attr("data-imgType");var url=contextPath+"/fore/user/userinfo/"+imgType;var formData=new FormData();formData.append("userInfoImg",imgInput.get(0).files[0]);$.ajax({type:"POST",url:url,data:formData,dataType:"text",cache:false,contentType:false,processData:false,mimeType:"multipart/form-data",success:function(response){if("success"==response){showSuccessTipModal("上传用户自定义图片","上传成功");hideTipModal()}else{showDangerTipModal("上传用户自定义图片","失败："+response)}}});var showImg=upLoadImgDiv.find(".showImg");if(showImg.length>1){upLoadImg.remove()}else{e.preventDefault()}})}jQuery(changeAndShowRealImg($));function changeAndShowRealImg(){var realImg=$(".realImg");var width=$(".upLoadImg-container").width();realImg.change(function(e){var btn=$(this).parents("upLoadImg").find(".resetImgBtn");var upLoadImg=$(this).parents("upLoadImg");var showImg=$(this).next().find('.showImg');var upLoadImgContainer=$(this).parents(".upLoadImg-container");var imgInfoTable=$(this).next().next().find("table");var imgInfoLastTd=imgInfoTable.find("td").last();var _URL=window.URL||window.webkitURL;var file,img;if((file=this.files[0])){img=new Image();img.onload=function(){showImg.attr('src',this.src).addClass("img-thumbnail").slideDown();showImg.css("width",width);if(upLoadImgContainer.height()<showImg.height()){upLoadImgContainer.height(Math.ceil(showImg.height())+10)}imgInfoLastTd.text(img.width+" * "+img.height);fillUpLoadImgInfoToTable(getFileInputInfo(file),imgInfoTable)};img.src=_URL.createObjectURL(file)}})}function fillUpLoadImgInfoToTable(imgInfo,infoTable){var imgInfoTd=infoTable.find("td");var len=imgInfoTd.length-1;imgInfoTd.each(function(index,element){var info=imgInfo[index];if(info&&index!=len){$(this).text(info)}})}jQuery(preViewUserImg($));function preViewUserImg(){var preViewImgBtn=$(".preViewImgBtn");var modal=$("#previewimg-modal");preViewImgBtn.click(function(e){modal.modal("show")})}function getOwnUserInfoImgPathByAjaxAndLoad(func){if(typeof func!='function'){return false}var url=contextPath+"/foregetOwnUserInfoImgPath";$.get(url,function(data,textStatus,jqXHR){var modal=$("");if(data){func(data,modal)}},"text")}function loadImgPathToCarusalInModal(data,modal){var img=modal.find("img");img.each(function(index,element){$(this).attr("src",data[index])})}var addressData;jQuery(getAddressJSONByAjaxAndInit($));function getAddressJSONByAjaxAndInit(){if(!addressData){$.getJSON(contextPath+'/scripts/provinceCity2018.json',function(data){addressData=data;loadAddressListToSelect(data,"select[id='province']")})}else{loadAddressListToSelect(addressData,"select[id='province']")}}function filterAddress(data,code){var d=data.filter(function(item,index,array){return(item["code"]==code)})[0];return d}function loadAddressListToSelect(data,select){$.each(data,function(index,value){var code=value['code'];var name=value['name'];var option=$("<option code="+code+" value="+code+">"+name+"</option>");option.appendTo(select)})}function clearNotFirstOptionInSelect(selectSelector){$(selectSelector+" option[code]").remove()}jQuery(selectAddress($));function selectAddress(){var province=$("select[id='province']");var city=$("select[id='city']");var area=$("select[id='area']");var cs=[];province.change(function(e){clearNotFirstOptionInSelect("select[id='city']");clearNotFirstOptionInSelect("select[id = 'area']");showAddress(fetechAddress());var code=province.val();if(!code){return false}var p=addressData.filter(function(item,index,array){return(item["code"]==code)})[0];var p=filterAddress(addressData,code);cs=p["cityList"];loadAddressListToSelect(cs,"select[id='city']")});city.change(function(e){clearNotFirstOptionInSelect("select[id = 'area']");showAddress(fetechAddress());var code=city.val();if(!code){return false}var c=filterAddress(cs,code);var as=c["areaList"];loadAddressListToSelect(as,"select[id='area']")});area.change(function(e){showAddress(fetechAddress())})}function fetechAddress(){var addressSelect=$("select[name^='address']");var addressOption=addressSelect.find("option:selected");var address=[];addressOption.each(function(index,element){var text=$(this).text();var val=$(this).val();if(!address.includes(text)&&val){address.push(text)}});return address}function showAddress(address){var addressInput=$("input[name=address]");var addressText="";$.each(address,function(index,value){addressText+=value});addressInput.val(addressText)}jQuery(userInfoForm($));function userInfoForm(){var form=$(".userinfo-form");initFormValidErrMsg(form);var userForm=$(".user-form");initFormValidErrMsg(userForm)}jQuery(clearLoginHistory($));function clearLoginHistory(){var btnSel=".clear-loginhistory-btn";var loginhistoryTable=$("#loginhistory-table");var failLoginhistoryTable=$("#fail-loginhistory-table");var tr=loginhistoryTable.find("tr").not("tr:first");var tr2=failLoginhistoryTable.find("tr").not("tr:first");$("body").on("click",btnSel,function(){var url=contextPath+"/foreclearLoginHistoryAsync";$.get(url,function(data,textStatus,jqXHR){if("success"==data){tr.slideUp(function(){tr.remove()});tr2.slideUp(function(){tr2.remove()});showAndHideSuccessTipToast("清空登陆历史成功")}else{showAndHideNormalTipToast(data)}},"text")})}function initsuspendMenu(suspendMenu,className){var mask=$(".mask");var categoryUlNav=$(".category-ul-nav");var windowWidth=$(window).width();if(windowWidth<768){if(!suspendMenu.hasClass(className)){suspendMenu.addClass(className).css("left","-50rem")}if(categoryUlNav.length!=0){categoryUlNav.addClass("nav-justified")}}else{mask.css("display","none");suspendMenu.removeClass(className).css("left","0");if(categoryUlNav.length!=0){categoryUlNav.removeClass("nav-justified")}}}function suspendMenu(){$(".suspend-menu-btn").click(function(e){e.preventDefault()})}jQuery(reSizesuspendMenu($));function reSizesuspendMenu(){var suspendMenu=$(".suspend-menu");var xssuspendMenuClassName="suspend-menu-xs";initsuspendMenu(suspendMenu,xssuspendMenuClassName);$(window).resize(function(){initsuspendMenu(suspendMenu,xssuspendMenuClassName)});opsuspendMenu(suspendMenu)}function opsuspendMenu(suspendMenu){var categoryUlNav=$(".category-ul-nav");var opensuspendMenu=$(".open-suspend-menu");var closesuspendMenu=$(".close-suspend-menu");var suspendMenuLeft=suspendMenu.css("left");var mask=$(".mask");opensuspendMenu.click(function(e){var windowWidth=$(window).width();if(windowWidth<768){mask.css("display","block");suspendMenu.animate({left:"0",});if(categoryUlNav.length!=0){categoryUlNav.addClass("nav-justified")}}});closesuspendMenu.click(function(e){var windowWidth=$(window).width();if(windowWidth<768){var suspendMenuWidth=suspendMenu.outerWidth();suspendMenu.animate({left:-suspendMenuWidth});mask.css("display","none");if(categoryUlNav.length!=0){categoryUlNav.removeClass("nav-justified")}}})}jQuery(reSizeSideMenu($));function reSizeSideMenu(){var sideMenu=$(".side-menu");opsideMenu(sideMenu)}function opsideMenu(sideMenu){var opensideMenu=$(".open-side-menu");var closesideMenu=$(".close-side-menu");var tipDialog=$(".tip-dialog");var sideMenuLeft=sideMenu.css("left");var mask=$(".mask");opensideMenu.click(function(e){mask.css("display","block");sideMenu.animate({right:"0",});tipDialog.animate({top:sideMenu.offset().top+sideMenu.height()*2,})});closesideMenu.click(function(e){var sideMenuWidth=sideMenu.outerWidth();sideMenu.animate({right:-sideMenuWidth});mask.css("display","none");tipDialog.animate({top:"10%",})})}function initSlider(slider,left,width){var sty={left:left,width:width};slider.css(sty)}function slideContentBottomSliderAsMouseEnter(){var bottomSlider=$(".bottom-slider");var firstLi=bottomSlider.find("li:first");var width=firstLi.outerWidth();var otherLi=bottomSlider.find("li").not(firstLi);var contentBottomSlider=otherLi.next().find(".content-bottom-slider");initSlider(contentBottomSlider,0,width);var firstLiOffsetLeft=firstLi.offset().left;$(window).resize(function(){firstLiOffsetLeft=firstLi.offset().left});otherLi.on({"mouseenter":function(){var ooWidth=$(this).outerWidth();var otherLiOffsetLeft=$(this).offset().left;contentBottomSlider.stop().width(ooWidth).animate({left:otherLiOffsetLeft-firstLiOffsetLeft},"fast")},"mouseleave":function(){contentBottomSlider.stop().width(width).animate({left:0},"fast")}});var li=bottomSlider.find("li");li.click(function(e){li.find("a").css("color","#292a2b");$(this).find("a").css("color","#C40000")})}function checkOwnArticle(aid){var url=contextPath+"/forecheckOwnArticle";var data={aid:aid,};var result="";$.ajax({type:"POST",url:url,data:data,dataType:"text",async:false,success:function(response){result=response},});var check=result.split("-");return check}jQuery(editArticleModal($));function editArticleModal(){var modal=$("#edit-article-modal");var form=$("#edit-article-form-modal");var fieldsOption={id:{message:"文章ID无效",validators:{notEmpty:{message:"文章ID不能为空"},}},title:{message:"文章标题无效",validators:{notEmpty:{message:"文章标题不能为空"},stringLength:{min:5,max:25,message:"文章标题长度必须在 5 - 25 之间"},}},subTitle:{message:"文章副标题无效",validators:{notEmpty:{message:"文章副标题不能为空"},stringLength:{min:5,max:60,message:"文章副标题长度必须在 5 - 60 之间"},}},cid:{message:"文章分类类型无效",validators:{notEmpty:{message:"文章分类类型不能为空"},}}};loadFieldMapDataToFormInModalOnClickBtnSelAndParentSelInParentsSel(modal,form,".article-ul",".edit-article-link",".article-item",fieldsOption,editArticleModalFunc);loadFieldMapDataToFormInModalOnClickBtnSelAndParentSelInParentsSel(modal,form,".group-ul",".edit-article-link",".group-item",fieldsOption,editArticleModalFunc)}function editArticleModalFunc(form,parent){var aid=form.find("[name=id]").val();var check=checkOwnArticle(aid);var isOwn=check[0];var articleStatu=check[1];if("no"==isOwn){showDangerTipModal("编辑文章","失败：你不配编辑此文章");return}if("DELETED"==articleStatu){showDangerTipModal("编辑文章","失败：不能编辑垃圾文章");return}var fieldAry=["title","subTitle","cid"];var newFieldMap=extractAsFieldAryToAndReturnNewFieldMap(form,fieldAry);var url=contextPath+"/foreeditArticleAsync";var data=form.serialize();$.ajax({type:"POST",url:url,data:data,dataType:"text",success:function(response){if(response.startsWith("fore")){loadDataAsFieldMapInEle(newFieldMap,parent);window.location.assign(contextPath+"/"+response)}else{var formOpErrmsg=form.find(".form-op-errmsg");var errMsg=formOpErrmsg.find(".errmsg");errMsg.text(response);formOpErrmsg.css("visibility","visible")}},})}jQuery(editArticleTableModal($));function editArticleTableModal(){var modal=$("#only-edit-article-modal");var form=$("#only-edit-article-form-modal");var table=$("#article-table");var fieldsOption={id:{message:"文章ID无效",validators:{notEmpty:{message:"文章ID不能为空"},}},title:{message:"文章标题无效",validators:{notEmpty:{message:"文章标题不能为空"},stringLength:{min:5,max:25,message:"文章标题长度必须在 5 - 25 之间"},}},subTitle:{message:"文章副标题无效",validators:{notEmpty:{message:"文章副标题不能为空"},stringLength:{min:5,max:60,message:"副标题长度必须在 5 - 60 之间"},}},cid:{message:"文章分类类型无效",validators:{notEmpty:{message:"文章分类类型不能为空"},}}};loadFieldMapDataFromTableToFormInModalOnClickBtnSelAndParentSel(modal,table,form,".edit-article-container",".edit-article-link",fieldsOption,onlyEditArticleModalFunc)}function onlyEditArticleModalFunc(form,btn,table){var modal=form.parents(".modal");var aid=form.find("[name=id]").val();var check=checkOwnArticle(aid);var isOwn=check[0];var articleStatu=check[1];if("no"==isOwn){showDangerTipModal("编辑文章","失败：你不配编辑此文章");return}if("DELETED"==articleStatu){showDangerTipModal("编辑文章","失败：不能编辑垃圾文章");return}var fieldAry=["title","subTitle","cid"];var newFieldMap=extractAsFieldAryToAndReturnNewFieldMap(form,fieldAry);var url=contextPath+"/foreonlyEditArticleAsync";var data=form.serialize();var fieldAry=["title","subTitle","cid"];var newFieldMap=extractAsFieldAryToAndReturnNewFieldMap(form,fieldAry);$.ajax({type:"POST",url:url,data:data,dataType:"text",success:function(response){if("success"==response){modal.modal("hide");showAndHideSuccessTipToast("仅编辑文章成功");loadDataAsFieldMapInTable(newFieldMap,btn,table)}else{var formOpErrmsg=form.find(".form-op-errmsg");var errMsg=formOpErrmsg.find(".errmsg");errMsg.text(response);formOpErrmsg.css("visibility","visible")}}})}jQuery(writeArticle($));function writeArticle(){var addArticleModal=$("#add-article-modal");var modalTitle=addArticleModal.find(".modal-title");var form=addArticleModal.find("#add-article-form-modal");var resetBtn=form.find("[type=reset]");var opErrMsg=form.find(".form-op-errmsg");var errMsg=opErrMsg.find(".errmsg");var fieldsOption={title:{message:"文章标题无效",validators:{notEmpty:{message:"文章标题不能为空"},stringLength:{min:5,max:25,message:"文章标题长度必须在 5 - 25 之间"},}},subTitle:{message:"文章副标题无效",validators:{notEmpty:{message:"文章副标题不能为空"},stringLength:{min:5,max:60,message:"文章副标题长度必须在 5 - 60 之间"},}},cid:{message:"文章分类类型无效",validators:{notEmpty:{message:"文章分类类型不能为空"},}}};$("body").on("click",".write-article-btn",function(e){e.preventDefault();if(!checkIsLogin())return;var btn=$(this);var articleStatu=btn.attr("articlestatu");var fieldMap=new Map();if("draft"==articleStatu){var draftText="草稿";fieldMap.set("articleStatu",draftText);modalTitle.text(draftText)}else if("article"==articleStatu||!articleStatu||""==articleStatu){var articleText="文章";fieldMap.set("articleStatu",articleText);modalTitle.text(articleText)}loadDataToFormAsFieldMap(form,fieldMap);addArticleModal.modal("show");boostrapValidate(form,fieldsOption);form.on('success.form.bv',function(e){e.preventDefault();var url=contextPath+"/"+form.attr("action");var data=form.serialize();$.ajax({type:"POST",url:url,data:data,dataType:"text",success:function(response){if("表单有误"==response){errMsg.text(response);opErrMsg.css("visibility","visible")}else{window.location.assign(contextPath+"/"+response)}}})})});resetBtn.click(function(e){e.preventDefault();form.find("[name]").not("[name=articleStatu]").val("");form.data('bootstrapValidator').resetForm()});addArticleModal.on('hidden.bs.modal',function(){form.data('bootstrapValidator').resetForm();resetBtn.click();opErrMsg.css("visibility","hidden")})}jQuery(deleteArticle($));function deleteArticle(){var modal=$("#thorough-delete");deleteArticleFunc(modal,".article-ul",".delete-article-btn",".article-item");deleteArticleFunc(modal,".group-ul",".delete-article-btn",".group-item")}function deleteArticleFunc(modal,parentsSel,btnSel,parentSel){var confirmBtn=modal.find("[type=submit]");$(parentsSel).on("click",btnSel,function(){if(!checkIsLogin())return;var btn=$(this);var parent=btn.parents(parentSel);var aid=btn.attr("data-id");var check=checkOwnArticle(aid);var articleStatu=check[1];if(!"DELETED"==articleStatu){showDangerTipModal("彻底删除文章","失败：不能彻底删除(该文章不在垃圾箱)");return}modal.modal("show");confirmBtn.click(function(e){var url=contextPath+"/foredeleteArticleAsync";var data={aid:aid,};e.preventDefault();$.post(url,data,function(data,textStatus,jqXHR){if("success"==data){parent.remove();modal.modal("hide");showSuccessTipModal("彻底删除文章","成功！！！");hideTipModal()}else{showDangerTipModal("彻底删除文章",data)}},"text")})})}function boostrapValidate(form,fieldsOption){if(form.length==0)return;form.bootstrapValidator({message:'This value is not valid',feedbackIcons:{valid:'glyphicon glyphicon-ok',invalid:'glyphicon glyphicon-remove',validating:'glyphicon glyphicon-refresh'},fields:fieldsOption})}jQuery(ontAndOtherTab($));function ontAndOtherTab(){$(".cust-tab-op").on("click",".one-tab-btn",function(){var btn=$(this);btn.hide();btn.parents(".cust-tab-op").find(".other-tab-btn").show()});$(".cust-tab-op").on("click",".other-tab-btn",function(){var btn=$(this);btn.hide();btn.parents(".cust-tab-op").find(".one-tab-btn").show()})}jQuery(showAndHideAsChecked($));function showAndHideAsChecked(){var parentsSel=".show-hide-checked";var btnSel="input[type=checkbox]";$(parentsSel).on("change",btnSel,function(){var btn=$(this);var parents=btn.parents(parentsSel);var checkedArea=parents.find(".checked-area");var uncheckedArea=parents.find(".unchecked-area");if(btn.prop("checked")){uncheckedArea.hide();checkedArea.fadeIn()}else{checkedArea.hide();uncheckedArea.fadeIn()}})}jQuery(addGroup($));function addGroup(){var modal=$("#add-group-modal");var modalTitle=modal.find(".modal-title");var form=modal.find("#add-group-modal-form");var opErrMsg=form.find(".form-op-errmsg");var errMsg=form.find(".errmsg");var resetBtn=form.find("[type=reset]");var fieldsOption={name:{message:"分组名无效",validators:{notEmpty:{message:"分组名不能为空"},stringLength:{min:1,max:25,message:"分组名长度必须在 1 - 25 之间"},}},visibility:{message:"显示/隐藏无效",validators:{notEmpty:{message:"显示/隐藏不能为空"},}},groupType:{message:"分组类型无效",validators:{notEmpty:{message:"分组类型不能为空"},}},};$("body").on("click",".add-group-btn",function(){var btn=$(this);var parent=btn.parents(".group-title");var groupType=btn.attr("grouptype");var groupTypeMap=new Map();if("articlefavority"==groupType){groupTypeMap.set("groupType","文章收藏");modalTitle.text("增加文章收藏分组")}else if("userfollow"==groupType){groupTypeMap.set("groupType","用户关注");modalTitle.text("增加用户关注分组")}loadDataToFormAsFieldMap(form,groupTypeMap);modal.modal("show");boostrapValidate(form,fieldsOption);form.on('success.form.bv',function(e){e.preventDefault();var data=form.serialize();var url=contextPath+"/"+form.attr("action");$.ajax({type:"POST",url:url,data:data,dataType:"text",success:function(response){var isSuccess=response.substr(0,response.indexOf("-"));var group=response.substr(response.indexOf("-")+1);if("success"==isSuccess){modal.modal("hide");showSuccessTipModal(modalTitle.text(),"成功");hideTipModal();window.location.reload()}else{errMsg.text(response);opErrMsg.css("visibility","visible")}}})}).on('error.field.bv',function(e,data){if(data.field=='groupType'){loadDataToFormAsFieldMap(form,groupTypeMap)}});resetBtn.click(function(e){e.preventDefault();form.get(0).reset();loadDataToFormAsFieldMap(form,groupTypeMap);form.data('bootstrapValidator').resetForm()});modal.on('hidden.bs.modal',function(){form.get(0).reset();form.data('bootstrapValidator').resetForm();opErrMsg.css("visibility","hidden")})})}function checkOwnGroup(gid){if(!checkIsLogin())return;var url=contextPath+"/forecheckOwnGroup";var isOwn=false;var data={gid:gid,};$.ajax({type:"POST",url:url,data:data,dataType:"text",async:false,success:function(response){if("yes"==response){isOwn=true}else{showDangerTipModal("编辑文章","失败：你不配编辑此分组")}}});return isOwn}jQuery(editGroup($));function editGroup(){var modal=$("#edit-group-modal");var modalTitle=modal.find(".modal-title");var form=modal.find("#edit-group-form-modal");var opErrMsg=form.find(".form-op-errmsg");var errMsg=form.find(".errmsg");var resetBtn=form.find("[type=reset]");var fillBtn=form.find(".fill-btn");var fieldsOption={id:{message:"分组ID无效",validators:{notEmpty:{message:"分组ID不能为空"},}},name:{message:"分组名无效",validators:{notEmpty:{message:"分组名不能为空"},stringLength:{min:1,max:25,message:"分组名长度必须在 1 - 25 之间"},}},visibility:{message:"显示/隐藏无效",validators:{notEmpty:{message:"显示/隐藏不能为空"},}},groupType:{message:"分组类型无效",validators:{notEmpty:{message:"分组类型不能为空"},}},};$("body").on("click",".edit-group-btn",function(){var btn=$(this);var parent=btn.parents(".group-title");var groupType=btn.attr("grouptype");var fieldTextMap=getFieldAttrTextReturnFieldMapFromBtnParentsSel(btn,".group-title");var fieldMap=getFieldAttrTextReturnFieldMapFromBtnParentsSel(btn,".group-title");var groupTypeMap=new Map();groupTypeMap.set("groupType",fieldMap.get("groupType"));if("articlefavority"==groupType){modalTitle.text("编辑文章收藏分组")}else if("userfollow"==groupType){modalTitle.text("编辑用户关注分组")}loadDataToFormAsFieldMap(form,fieldMap);modal.modal("show");boostrapValidate(form,fieldsOption);form.unbind("success.form.bv").bind("success.form.bv",function(e){e.preventDefault();if(checkFormRepeatAsFieldMap(form,fieldMap)){errMsg.text("改都没改还想提交");opErrMsg.css("visibility","visible")}else{if(!checkOwnGroup(fieldMap.get("id"))){showDangerTipModal(modalTitle.text(),"失败：你不配编辑此分组");return}var formData=new FormData(form.get(0));var url=contextPath+"/"+form.attr("action");$.ajax({type:"POST",url:url,data:formData,cache:false,contentType:false,processData:false,dataType:"text",success:function(response){if("success"==response){var gid=formData.get("id");var fieldAry=["name","visibility"];var newFieldMap=extractAsFieldAryToAndReturnNewFieldMap(form,fieldAry);modal.modal("hide");showSuccessTipModal(modalTitle.text(),"成功");hideTipModal();var menuItem=$(".menu-item[data-id="+gid+"]");var groupName=$(".group-name[data-id="+gid+"]");loadDataAsFieldMapInEle(newFieldMap,groupName);loadDataAsFieldMapInEle(newFieldMap,menuItem)}else{errMsg.text(response);opErrMsg.css("visibility","visible")}}})}}).on('error.field.bv',function(e,data){if(data.field=='id'){form.find("[name=id]").val(fieldMap.get("id"))}else if(data.field=='groupType'){loadDataToFormAsFieldMap(form,groupTypeMap)}});fillBtn.click(function(e){loadDataToFormAsFieldMap(form,fieldMap);form.data('bootstrapValidator').resetForm()});resetBtn.click(function(e){e.preventDefault();form.get(0).reset();form.find("[name=id]").val(fieldMap.get("id"));loadDataToFormAsFieldMap(form,groupTypeMap);form.data('bootstrapValidator').resetForm()})});modal.on('hidden.bs.modal',function(){form.data('bootstrapValidator').resetForm();resetBtn.click();opErrMsg.css("visibility","hidden")})}jQuery(deleteGroup($));function deleteGroup(){var modal=$("#delete-group-modal");var isSave=modal.find("[name=isSave]");isSave.change(function(e){});var modalTitle=modal.find(".modal-title");var modalBody=modal.find(".modal-body");var confirmBtn=modal.find(".confirm-btn");$("body").on("click",".delete-group-btn",function(){var btn=$(this);var groupType=btn.attr("grouptype");var groupMenuItem=btn.parents(".menu-item");var group=$("group-content").find("[field="+id+"]").parents(".group-item");var id=getIdOnEle(groupMenuItem);if("articlefavority"==groupType){modalTitle.text("删除文章收藏分组");modalBody.text("确认删除该文章收藏分组吗？")}else if("userfollow"==groupType){modalTitle.text("删除用户关注分组");modalBody.text("确认删除该用户关注分组吗？")}modal.modal("show");confirmBtn.click(function(e){var url=contextPath+"/foredeleteGroupAsync";var data={gid:id,isSave:modal.find("input[name=isSave]:checked").val()};$.post(url,data,function(data,textStatus,jqXHR){modal.modal("hide");if("delete"==data||"deleteAll"==data){groupMenuItem.remove();group.remove()}if("delete"==data){showAndHideSuccessTipToast("删除分组成功");showAndHideSuccessTipToast("已将分组相关放到默认组")}else if("deleteAll"==data){showAndHideSuccessTipToast("删除分组成功")}else{showDangerTipModal("删除分组",data)}},"text")})});modal.on('hide.bs.modal',function(){isSave.prop("checked",false);var checkedArea=modal.find(".checked-area");var uncheckedArea=modal.find(".unchecked-area");checkedArea.hide();uncheckedArea.fadeIn()})}function extractAsFieldAryToAndReturnNewFieldMap(form,fieldAry){var newFieldMap=new Map();$.each(fieldAry,function(index,value){var formEle=form.find("[name="+value+"]");var tag=formEle.prop("nodeName");var type=formEle.attr("type");if("INPUT"==tag){if("radio"==type){var checkedFormEle=form.find("[name="+value+"]:checked");newFieldMap.set(value,checkedFormEle.nextAll("span").not("span[class]").text())}else if("checkbox"==type){formEle.each(function(index,element){var ele=$(this);if(ele.prop("checked")){newFieldMap.set(value,ele.next().text());return false}})}else{newFieldMap.set(value,formEle.val())}}else if("SELECT"==tag){var checkedOption=formEle.find("option:checked");newFieldMap.set(value,checkedOption.text())}else if("TEXTAREA"==tag){newFieldMap.set(value,formEle.val())}});return newFieldMap}function loadDataAsFieldMapInEle(fieldMap,ele){if(ele.length==0)return;for(var[key,value]of fieldMap){var field=ele.find("[field="+key+"]");field.text(value)}}function loadDataAsFieldMapInTable(fieldMap,btn,table){var fieldIndex=getFieldIndexFromTableTh(table);var td=btn.parents("tr").find("td");for(var[key,value]of fieldIndex){if(fieldMap.has(value)){$(td.get(key)).text(fieldMap.get(value))}}}jQuery(listGroup($));function listGroup(){var modal=$("#list-group-modal");var fieldsOption={name:{message:"分组名无效",validators:{notEmpty:{message:"分组名不能为空"},stringLength:{min:1,max:25,message:"分组名长度必须在 1 - 25 之间"},}},visibility:{message:"显示/隐藏无效",validators:{notEmpty:{message:"显示/隐藏不能为空"},}},groupType:{message:"分组类型无效",validators:{notEmpty:{message:"分组类型不能为空"},}},};listGroupAsIdAndGroupTypeOnBtnInEle(modal);newGroup(modal,fieldsOption)}function listGroupAsIdAndGroupTypeOnBtnInEle(modal){var modalTitle=modal.find(".modal-title");var addForm=modal.find("#add-group-form-tab");var newGroupBtn=modal.find(".new-group-btn");var listForm=modal.find("#list-group-form-tab");var custCheckbox=modal.find(".cust-checkbox");$("body").on("click",".list-group-btn",function(){if(!checkIsLogin())return;var btn=$(this);var id=btn.attr("data-id");var groupType=btn.attr("grouptype");switch(groupType){case"userfollow":groupType=0;modalTitle.text("关注用户");listForm.attr("action","forefollowUserAsync");newGroupBtn.attr("grouptype","userfollow");break;case"articlefavority":groupType=1;listForm.attr("action","forecollectArticleAsync");modalTitle.text("收藏文章");newGroupBtn.attr("grouptype","articlefavority");break}var url=contextPath+"/forelistGroupAsync";var data={id:id,groupType:groupType,};var groupIdAry=[];custCheckbox.empty();$.ajax({type:"POST",url:url,data:data,dataType:"text",async:false,success:function(data){var groups=data.substr(0,data.indexOf("]")+1);var abouts=data.substr(data.indexOf("]")+2);$.each($.parseJSON(groups),function(index,group){var label="<label class='cust-checkbox-label'><input type='checkbox' value="+group.id+" name='gid'><span class='text-muted'>"+group.name+"</span></label>";custCheckbox.append(label)});$.each($.parseJSON(abouts),function(index,about){var id=about.gid;var checkbox=custCheckbox.find("input[value="+id+"]");checkbox.prop("checked",true);groupIdAry.push(about.gid)});var selectedNum=listForm.find(".selected-num");selectedNum.text(groupIdAry.length);modal.modal("show")}});modal.on('hide.bs.modal',function(){listForm.get(0).reset();addForm.get(0).reset();groupIdAry=[]});listGroupForm(modal,btn,listForm,groupIdAry)})}function newGroup(modal,fieldsOption){var otherTabBtn=modal.find(".other-tab-btn");var newGroupBtn=modal.find(".new-group-btn");var custCheckbox=modal.find(".cust-checkbox");var modalTitle=modal.find(".modal-title");var addForm=modal.find("#add-group-form-tab");var opErrMsg=addForm.find(".form-op-errmsg");var errMsg=addForm.find(".errmsg");var resetBtn=addForm.find("[type=reset]");$("body").on("click",".new-group-btn",function(){var btn=$(this);var groupType=btn.attr("grouptype");var groupTypeMap=new Map();if("articlefavority"==groupType){groupTypeMap.set("groupType","文章收藏");modalTitle.text("增加文章收藏分组")}else if("userfollow"==groupType){groupTypeMap.set("groupType","用户关注");modalTitle.text("增加用户关注分组")}loadDataToFormAsFieldMap(addForm,groupTypeMap);modal.modal("show");boostrapValidate(addForm,fieldsOption);addForm.on('success.form.bv',function(e){e.preventDefault();var url=contextPath+"/"+addForm.attr("action");var addFormData=new FormData(addForm.get(0));var data={name:addFormData.get("name"),visibility:addFormData.get("visibility"),groupType:addFormData.get("groupType"),};$.ajax({type:"POST",url:url,data:data,dataType:"text",success:function(response){var data=response.split("-");var statu=data[0];var group=JSON.parse(data[1]);if("success"==statu){var label="<label class='cust-checkbox-label'><input type='checkbox' value="+group.id+" name='gid' checked><span class='text-muted'>"+group.name+"</span></label>";custCheckbox.append(label);otherTabBtn.click()}else{errMsg.text(response);opErrMsg.css("visibility","visible")}}})}).on('error.field.bv',function(e,data){if(data.field=='groupType'){loadDataToFormAsFieldMap(form,groupTypeMap)}});resetBtn.click(function(e){e.preventDefault();addForm.get(0).reset();loadDataToFormAsFieldMap(addForm,groupTypeMap);addForm.data('bootstrapValidator').resetForm()});modal.on('hidden.bs.modal',function(){addForm.get(0).reset();addForm.data('bootstrapValidator').resetForm();otherTabBtn.click()})})}function listGroupForm(modal,btn,form,groupIdAry){var opSuccessMsg=form.find(".form-op-successmsg");var successMsg=opSuccessMsg.find("errmsg");var opErrMsg=form.find(".form-op-errmsg");var errMsg=opErrMsg.find("errmsg");var selectedNum=form.find(".selected-num");var confirmBtn=form.find(".confirm-btn");var newGroupIdAry=[];confirmBtn.attr("disabled",true);form.on("change",".cust-checkbox-label",function(){var checkedBox=form.find("input[type=checkbox]:checked");selectedNum.text(checkedBox.length);newGroupIdAry=[];$.each(checkedBox,function(index,value){var gid=$(value).val();if(!newGroupIdAry.includes(gid)){newGroupIdAry.push(gid)}});if(checkAryValueIsConsitent(groupIdAry,newGroupIdAry)){confirmBtn.attr("disabled",true)}else{confirmBtn.attr("disabled",false)}});confirmBtn.unbind("click").bind("click",function(e){e.preventDefault();if(checkAryValueIsConsitent(groupIdAry,newGroupIdAry))return;var url=contextPath+"/"+form.attr("action");if(!form.serialize()){href=url.concat("?id="+btn.attr("data-id"))}else{href=url.concat("?id="+btn.attr("data-id")+"&"+form.serialize())}$.ajax({type:"POST",url:href,dataType:"text",success:function(response){modal.modal("hide");if("yes"==response||"no"==response){var isOp=("yes"==response)?true:false;opAfterlistGroup(btn,isOp);return}showAndHideDangerTipToast(response)}})})}function opAfterlistGroup(btn,isOp){var groupType=btn.attr("grouptype");switch(groupType){case"articlefavority":if(isOp){showAndHideSuccessTipToast("收藏文章成功");btn.addClass("btn-success")}else{showAndHideSuccessTipToast("取消收藏文章成功");btn.removeClass("btn-success")}break;case"userfollow":if(isOp){showAndHideSuccessTipToast("关注用户成功");btn.addClass("btn-success")}else{showAndHideSuccessTipToast("取消关注用户成功");btn.removeClass("btn-success")}break}}jQuery(clearOneArticleFavorityInGroup($));function clearOneArticleFavorityInGroup(){$(".container-group").on("click",".clear-af-btn",function(){if(!checkIsLogin())return;var btn=$(this);var articleItem=btn.parents(".article-item");var groupItem=btn.parents(".group-item");var parent=(articleItem.length!=0)?articleItem:groupItem;var id=btn.attr("data-id");var url=contextPath+"/foreclearDsgtInvalidArticleFavorityInGroupAsync";var data={afid:id,};$.post(url,data,function(data,textStatus,jqXHR){if(id==data){parent.slideUp(function(){parent.remove()});showAndHideSuccessTipToast("清除组内指定失效成功")}else{showDangerTipModal("清除组内指定失效",data)}},"text")})}function removeInvalidArticleFavority(ids,parentSel,parentsSel){var parents=$(parentsSel);var invalidParent=parents.find(parentSel+"[invalid]");$.each(invalidParent,function(index,value){var ele=$(this);var invalidId=ele.attr("invalid");if(ids.includes(invalidId)){ele.remove()}return true})}jQuery(clearInvalidArticleFavoritiesInDsgtGroupAsync($));function clearInvalidArticleFavoritiesInDsgtGroupAsync(){var parentsSel=".container-group";var parentSel=".group-item";var btnSel=".clear-dgst-group-btn";var url=contextPath+"/foreclearInvalidArticleFavoritiesInDsgtGroupAsync";$(parentsSel).on("click",btnSel,function(){if(!checkIsLogin())return;var btn=$(this);var data={gid:btn.attr("data-id"),};$.post(url,data,function(data,textStatus,jqXHR){var response=data.split("-");var isSuccess=response[0];if("success"==isSuccess){var ids=response[1];removeInvalidArticleFavority(ids,parentSel,parentsSel);showSuccessTipModal("清除指定组内失效文章","成功清除！！！");hideTipModal()}else{showDangerTipModal("清除指定组内失效文章",data)}},"text")})}jQuery(clearInvalidArticleFavoritiesInAllGroupAsync($));function clearInvalidArticleFavoritiesInAllGroupAsync(){var parentsSel="body";var parentSel=".group-item";var btnSel=".clear-all-group-btn";var url=contextPath+"/foreclearInvalidAFInAllGroupsAsync";$(parentsSel).on("click",btnSel,function(){if(!checkIsLogin())return;$.post(url,function(data,textStatus,jqXHR){var response=data.split("-");var isSuccess=response[0];if("success"==isSuccess){var ids=response[1];removeInvalidArticleFavority(ids,parentSel,parentsSel);showSuccessTipModal("清除所有组内失效文章","成功清除！！！");hideTipModal()}else{showDangerTipModal("清除所有组内失效文章",data)}},"text")})}jQuery(openAndCloseUserOpPanel($));function openAndCloseUserOpPanel(){$(".op-user-panel").click(function(e){var opUserPanel=$(this);var open="open";var close="close";var userOpPanel=opUserPanel.prev();if(opUserPanel.hasClass(open)){userOpPanel.stop().slideDown();opUserPanel.css("transform","rotate(0)").attr("title","点击关闭").removeClass(open).addClass(close)}else{userOpPanel.stop().slideUp();opUserPanel.css("transform","rotate(180deg)").attr("title","点击打开").removeClass(close).addClass(open)}})}function checkIsLogin(){var url=contextPath+"/forecheckIsLogin";var isLogin=false;$.ajax({type:"GET",url:url,dataType:"text",async:false,success:function(response){if("yes"==response){isLogin=true}else{$("#login-modal").modal("show")}}});return isLogin}jQuery(publicAjax($));function publicAjax(){$(document).ajaxError(function(){showDangerTipModal("发送请求","失败：请检查网络");hideTipModal()})}function loadingAsync(btnSel,successFunc){var asyncEle=$(".async");var asyncLoading=asyncEle.find(".async-loading");var asyncContainer=asyncEle.find(".async-container");if(asyncLoading.length==0){asyncEle.append("<div class='async-loading'><span class='glyphicon glyphicon-refresh'></span><span class='text-muted'>刷新中。。。</span></div>");asyncLoading=asyncEle.find(".async-loading")}asyncEle.on("click",btnSel,function(){$.ajax({type:"POST",url:"fore/dfadf",data:"data",dataType:"text",beforeSend:function(xhr){asyncContainer.fadeOut();asyncLoading.css("display","flex")},success:function(response){successFunc(response,asyncContainer)},error:function(){asyncContainer.fadeIn();asyncLoading.fadeOut();showDangerTipModal("发送请求","失败：请检查网络");hideTipModal()}})})}function loadFieldErrMsgMapToForm(fieldErrMsgMap,form){for(var[key,value]of fieldErrMsgMap){var jqTd=$(td[key]);fieldMap.set(value,jqTd.text())}}function loadOpErrMsgToForm(opErrMsg,form){var jqOpErrMsg=form.find(".form-op-errmsg .errmsg");jqOpErrMsg.text(opErrMsg).css("visibility","visible")}jQuery(loginModal($));function loginModal(){var modal=$("#login-modal");var opErrMsg=modal.find(".form-op-errmsg");var errMsg=opErrMsg.find(".errmsg");var form=modal.find("#login-form-modal");var btn=form.find("button");var fieldsOption={name:{message:"用户名无效",validators:{notEmpty:{message:"用户名不能为空"},stringLength:{min:2,max:25,message:"标题长度必须在 2 - 25 之间"},}},password:{message:"密码无效",validators:{notEmpty:{message:"密码不能为空"},stringLength:{min:5,max:60,message:"密码长度必须在 5 - 60 之间"},identical:{field:'repassword',message:"确认密码必须与密码相同",},}},repassword:{message:"确认密码无效",validators:{notEmpty:{message:"确认密码不能为空"},identical:{field:'password',message:"确认密码必须与密码相同",},}}};boostrapValidate(form,fieldsOption);form.on('success.form.bv',function(e){e.preventDefault();var url=contextPath+"/foreloginAsync";var data=form.serialize();$.ajax({type:"POST",url:url,data:data,dataType:"text",success:function(response){if(response.startsWith("fore")){window.location.assign(contextPath+"/"+response)}else{errMsg.text(response);opErrMsg.css("visibility","visible")}}})})}function getFieldIdFormParentsSelAndExcuteFunc(parentsSel,changeBtn,parentSel,func){$(parentsSel).on("click",changeBtn,function(e){e.preventDefault();var btn=$(this);var parent=btn.parents(parentSel);var id=getIdOnEle(parent);func(parent,btn,id)})}function changeArticleStatuAsync(parent,btn,id){var check=checkOwnArticle(id);var isOwn=check[0];var articleStatu=check[1];if("no"==isOwn){showDangerTipModal("改变文章状态","失败：你不配改变此文章状态")}else{var url=contextPath+"/"+btn.attr("data-href");var oldAs=getArticleStatuDesc(articleStatu);var newAs=getArticleStatuDesc(getArticleStatuFormUrl(url));var modal=$("#change-"+getArticleStatuFormUrl(url));modal.modal("show");var confirmBtn=modal.find(".confirm-btn");confirmBtn.click(function(e){e.preventDefault();$.post(url,function(data,textStatus,jqXHR){if("success"==data){parent.remove();modal.modal("hide");showSuccessTipModal("改变文章状态","成功：已由 "+oldAs+" 转到 "+newAs);hideTipModal()}else{showDangerTipModal("改变文章状态",data)}},"text")})}}jQuery(changeArticleStatu($));function changeArticleStatu(){getFieldIdFormParentsSelAndExcuteFunc(".article-ul",".change-articlestatu-link",".article-item",changeArticleStatuAsync);getFieldIdFormParentsSelAndExcuteFunc(".group-ul",".change-articlestatu-link",".group-item",changeArticleStatuAsync)}function getArticleStatuDesc(articleStatu){switch(articleStatu){case"WAIT_PUBLISH","Drafts","drafts":return"草稿箱";case"PUBLISH","Articles","articles","article":return"文章箱";case"DELETED","Dustbin","dustbin":return"垃圾箱"}if("WAIT_PUBLISH"==articleStatu){return"草稿箱"}else if("PUBLISH"==articleStatu){return"文章箱"}else if("DELETED"==articleStatu){return"垃圾箱"}}function getArticleStatuFormUrl(url){if(url.search("Article")!=-1){return"article"}else if(url.search("Drafts")!=-1){return"drafts"}else if(url.search("Dustbin")!=-1){return"dustbin"}}jQuery(editUserForm($));function editUserForm(){var editUserForm=$(".user-form");var parent=editUserForm.parents("#userpwd-setting");var susccessOpMsg=parent.find();var errOpMsg=parent.find(".form-op-errmsg");var errMsg=errOpMsg.find(".errmsg");var fieldsOption={password:{message:"密码无效",validators:{notEmpty:{message:"密码不能为空"},stringLength:{min:5,max:60,message:"密码长度必须在 5 - 60 之间"},identical:{field:'repassword',message:"确认密码必须与密码相同",},}},repassword:{message:"确认密码无效",validators:{notEmpty:{message:"确认密码不能为空"},identical:{field:'password',message:"确认密码必须与密码相同",},}}};boostrapValidate(editUserForm,fieldsOption)}jQuery(backToNextPage($));function backToNextPage(){var backNextPage=$(".back-to-next-page");backNextPage.click(function(e){window.history.back()})}jQuery(drag($));function drag(){$("body").on("mousedown",".drag-part",function(e){var dragPart=$(this);dragPart.draggable({}).delay(3000).draggable({revert:true})})}function showCountDownSeconds(intervalVar,spanSel,initCountDownNum,delay){clearInterval(intervalVar);var temp=initCountDownNum;$(spanSel).text(temp);intervalVar=setInterval(function(){temp-=1;$(spanSel).text(temp);if(temp==0){clearInterval(intervalVar)}},delay)}$(function(){$("[data-toggle='popover']").popover()});$(function(){$("[data-toggle='tooltip']").tooltip()});function checkOwnArticleConetnt(aid,acid){var url=contextPath+"/forecheckOwnArticleContent";var data={aid:aid,acid:acid,};var check="";$.ajax({type:"POST",url:url,data:data,async:false,dataType:"text",success:function(response){check=response.split("-")}});return check}jQuery(autoSaveArticleContent($));function autoSaveArticleContent(){var form=$("#edit-articlecontent-form");var fieldsOption={id:{message:"文章内容ID无效",validators:{notEmpty:{message:"文章内容ID不能为空"},}},aid:{message:"文章ID无效",validators:{notEmpty:{message:"文章ID不能为空"},}},};boostrapValidate(form,fieldsOption);form.on('error.form.bv',function(e){showAndHideDangerTipToast("老弟，表单有误")}).on('success.form.bv',function(e){if(!showArticleMarkdown.getMarkdown()){e.preventDefault();form.data('bootstrapValidator').resetForm();showAndHideDangerTipToast("老弟，文章内容不能为空");return}else if(showArticleMarkdown.getMarkdown().length<5){e.preventDefault();form.data('bootstrapValidator').resetForm();showAndHideDangerTipToast("老弟，文章内容至少要在5以上");return}});var autoSave=$("input[name=isAutoSave]");var spanSel=".countdown-time";var initCountDownNum=10;var editArticleTimeOut,delay=initCountDownNum*1000;var countDownSeconds;autoSave.change(function(e){if(autoSave.prop("checked")){showAndHideSuccessTipToast("已开启自动保存文章");showArticleMarkdown.on("change",function(){if(!form.data('bootstrapValidator').isValid()){form.data('bootstrapValidator').validate()}if(!showArticleMarkdown.getMarkdown()){e.preventDefault();showAndHideDangerTipToast("老弟，文章内容不能为空");clearTimeout(editArticleTimeOut);return}else if(showArticleMarkdown.getMarkdown().length<5){e.preventDefault();showAndHideDangerTipToast("老弟，文章内容至少要在5以上");clearTimeout(editArticleTimeOut);return}showCountDownSeconds(countDownSeconds,spanSel,initCountDownNum,1000);clearTimeout(editArticleTimeOut);$(spanSel).text(initCountDownNum);editArticleTimeOut=setTimeout(function(){var formData=new FormData(form.get(0));var check=checkOwnArticleConetnt(formData.get("aid"),formData.get("id"));var isOwn=check[0];var isMatch=check[1];if("no"==isOwn){showDangerTipModal("编辑文章内容","失败：你不配编辑此文章");return}if("no"==isMatch){showDangerTipModal("编辑文章内容","失败：文章与文章内容的ID不符合");return}if("yes"==isOwn&&"yes"==isMatch){var url=contextPath+"/foreeditArticleContentAsync";var data={id:formData.get("id"),aid:formData.get("aid"),mdContent:formData.get("mdContent"),};$.post(url,data,function(data,textStatus,jqXHR){if("success"==data){showAndHideSuccessTipToast("成功保存文章")}else{showAndHideDangerTipToast(data)}},"text")}},delay)})}else{showAndHideSuccessTipToast("已取消自动保存文章");showArticleMarkdown.off("change");clearInterval(countDownSeconds);clearTimeout(editArticleTimeOut);$(spanSel).text(initCountDownNum)}})}function editArticleContent(){var saveArticleBtn=$(".save-article-btn");var fieldsOption={};saveArticleBtn.click(function(e){e.preventDefault();var form=$(this).parents("form");var aid=form.find("[name=aid]").val();var check=checkOwnArticle(aid);var isOwn=check[0];var articleStatu=check[1];var isOwn=check[0];var articleStatu=check[1];if("no"==isOwn){showDangerTipModal("编辑文章","失败：你不配编辑此文章");return}if("DELETED"==articleStatu){showDangerTipModal("编辑文章","失败：不能编辑垃圾文章");return}if("yes"==isOwn&&!"DELETED"==articleStatu){var url=form.attr("action");var formData=new FormData(form.get(0));$.ajax({type:"POST",url:url,data:formData,dataType:"text",success:function(response){if("success"==response){showSuccessTipModal("编辑文章内容","成功：已保存");hideTipModal()}else{showAndHideDangerTipToast(response)}}})}})}jQuery(searchBar($));function searchBar(){var form=$(".search-user-article-form");var fieldsOption={title:{message:"文章标题无效",validators:{notEmpty:{message:"文章标题不能为空"},},},};boostrapValidate(form,fieldsOption)}jQuery(savePartOfUserSetting($));function savePartOfUserSetting(){var parentsSel=".user-setting-panel";var btnSel=".save-part-usersetting-btn";var inputSel="input[type=checkbox]";$(parentsSel).on("click",inputSel,function(){var input=$(this);var inputName=input.attr("name");var parent=input.parents(parentsSel);var panelFooter=parent.find(".panel-footer");var btn=parent.find(btnSel);var origin=parent.find("[field="+inputName+"]");var originVal=origin.text();var inputVal=(input.prop("checked"))?1:0;if(originVal==inputVal){btn.attr("disabled",true);panelFooter.slideUp();return}else{btn.attr("disabled",false);panelFooter.slideDown()}btn.unbind("click").bind("click",function(){var formData=new FormData();formData.append(inputName,inputVal);var url=contextPath+"/foresaveUserSettingOfHistoryAsync";$.ajax({type:"POST",url:url,data:formData,dataType:"text",cache:false,contentType:false,processData:false,mimeType:"multipart/form-data",success:function(response){if("fail"==response){input.click();showAndHideDangerTipToast("用户设置失败")}else{origin.text(inputVal);showAndHideSuccessTipToast(response);btn.attr("disabled",true);panelFooter.slideUp()}}})})})}jQuery(deleteArticleHistory($));function deleteArticleHistory(){var btnSel=".delete-ah-btn";var parentSel=".article-history-item";var parentsSel=".article-history-body";var parents=$(parentsSel);parents.on("click",btnSel,function(){var btn=$(this);var parent=btn.parents(parentSel);var url=contextPath+"/foredeleteArticleHistoryAsync";var data={ahid:btn.attr("data-id"),};$.post(url,data,function(data,textStatus,jqXHR){if("success"==data){parent.slideUp("fast",function(){parent.remove();showAndHideSuccessTipToast("删除文章历史成功");showNoArticleHistoryHtml(parentsSel,parentSel)})}else{showAndHideDangerTipToast(data)}},"text")})}jQuery(clearArticleHistory($));function clearArticleHistory(){var btnSel=".clear-ah-btn";var parentSel=".article-history-item";var parentsSel=".article-history";var parents=$(parentsSel);var parent=parents.find(parentSel);parents.on("click",btnSel,function(){var url=contextPath+"/foreclearArticleHistoryAsync";$.post(url,function(data,textStatus,jqXHR){if("success"==data){parent.slideUp(function(){parent.remove();showAndHideSuccessTipToast("清空文章历史成功");showNoArticleHistoryHtml(".article-history-body",parentSel)})}else{showAndHideNormalTipToast(data)}},"text")})}function showNoArticleHistoryHtml(parentsSel,parentSel){var parents=$(parentsSel);var parent=parents.find(parentSel);if(parent.length!=0)return;var noArticleHistory=$(`<div class="jumbotron no-articlehistory"><h2>目前还未有<span class="glyphicon glyphicon-time"></span>文章历史，请去<a href="${contextPath}/forehome">首页</a></h2></div>`);if($(".no-articlehistory").length==0){parents.append(noArticleHistory)}}